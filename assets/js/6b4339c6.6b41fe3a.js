"use strict";(self.webpackChunkrouter_docs=self.webpackChunkrouter_docs||[]).push([[1092],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(h,o(o({ref:t},p),{},{components:n})):r.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11012:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const i={title:"ASM Implementation",sidebar_position:1},o=void 0,s={unversionedId:"message-transfer-via-crosstalk/evm-guides/asm-implementation/README",id:"message-transfer-via-crosstalk/evm-guides/asm-implementation/README",title:"ASM Implementation",description:"To understand how Router ASM works refer here.",source:"@site/docs/develop/message-transfer-via-crosstalk/evm-guides/asm-implementation/README.md",sourceDirName:"message-transfer-via-crosstalk/evm-guides/asm-implementation",slug:"/message-transfer-via-crosstalk/evm-guides/asm-implementation/",permalink:"/develop/message-transfer-via-crosstalk/evm-guides/asm-implementation/",draft:!1,editUrl:"https://github.com/router-protocol/docs/tree/main/docs/develop/message-transfer-via-crosstalk/evm-guides/asm-implementation/README.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"ASM Implementation",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Sample Read Request Contract",permalink:"/develop/message-transfer-via-crosstalk/evm-guides/cross-chain-read-requests/sample-read-request-contract"},next:{title:"Integrate ASM into Your Application",permalink:"/develop/message-transfer-via-crosstalk/evm-guides/asm-implementation/integrate-asm-into-your-application"}},l={},c=[{value:"Important Notes",id:"important-notes",level:3}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"To understand how Router ASM works refer ",(0,a.kt)("a",{parentName:"p",href:"../../message-transfer-via-crosstalk/key-concepts/additional-security-modules#how-does-an-asm-work"},"here"),".")),(0,a.kt)("p",null,"The function signature named ",(0,a.kt)("inlineCode",{parentName:"p"},"verifyCrossChainRequest")," is present in the ",(0,a.kt)("inlineCode",{parentName:"p"},"IAdditionalSecurityModule")," interface. This function serves to provide additional security for a specific cross-chain flow."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"function verifyCrossChainRequest(\n      uint256 requestIdentifier,\n      uint256 requestTimestamp,\n      string calldata requestSender,\n      string calldata srcChainId,\n      bytes calldata packet,\n      address handler\n) external returns (bool);\n")),(0,a.kt)("p",null,"When a request is received on the destination chain, the ",(0,a.kt)("inlineCode",{parentName:"p"},"verifyCrossChainRequest")," function selector is called on the specified ASM address before executing the user's contract calls. The ASM implementation can return true/false for instantly validating/invalidating the request. However, if they require more time for request validation, they can revert the request from their ASM."),(0,a.kt)("p",null,"As mentioned earlier, if this function returns ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),", the execution of the user contract calls will continue. If the return value is ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),", the execution of the user's contract calls will be skipped. If the ASM implementation reverts the request, then the transaction will be reverted, and no state will be modified on the Gateway as well."),(0,a.kt)("p",null,"The ASM module can revert the request until it is able to validate/invalidate the request. This will ensure that the application-level validation is completed before a cross-chain request is executed on the Gateway contract and sent to the user's destination contract."),(0,a.kt)("p",null,"Since this function can called from the Gateway contract only, it must have the following security check."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'require(msg.sender == <the Gateway contract address>, "Caller is not Gateway");\n')),(0,a.kt)("p",null,"In this function selector, there are 6 arguments. Within this function, any possible business logic or validation can be added using these arguments. Each argument has its own purpose in the\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"verifyCrossChainRequest"),"\xa0request:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1) ",(0,a.kt)("inlineCode",{parentName:"strong"},"requestIdentifier")," -")," A unique identifier of the request. It is added by the source chain's Gateway contract."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2) ",(0,a.kt)("inlineCode",{parentName:"strong"},"requestTimestamp")," -")," Timestamp when a request is added/verified on the Router chain."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3) ",(0,a.kt)("inlineCode",{parentName:"strong"},"requestSender")," -")," Address of the application's contract on the source chain in string format."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"4) ",(0,a.kt)("inlineCode",{parentName:"strong"},"srcChainId")," -")," Network ID of the chain from which the request to the Router chain was initiated."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"5) ",(0,a.kt)("inlineCode",{parentName:"strong"},"packet")," -")," This is the payload, i.e., the data to be transferred to the destination chain."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"6) ",(0,a.kt)("inlineCode",{parentName:"strong"},"handler")," -")," Address of the application's smart contract on the destination chain in address format."),(0,a.kt)("h3",{id:"important-notes"},"Important Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"For ASMs to work, you need to import\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"IAdditionalSecurityModule.sol"),"\xa0file from ",(0,a.kt)("inlineCode",{parentName:"p"},"@routerprotocol/evm-gateway-contracts")," and inherit it into your ASM. You can use either one of the following commands for the same:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @routerprotocol/evm-gateway-contracts@1.1.11\n")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @routerprotocol/evm-gateway-contracts@1.1.11\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"IAdditionalSecurityModule"),"\xa0is the interface that contains selectors for\xa0the ",(0,a.kt)("inlineCode",{parentName:"p"},"verifyCrossChainRequest"),"\xa0functions.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Add your business logic into these functions and you're done. You just need to provide the address for this ASM contract deployed on the destination chain while initiating the cross-chain request on the source chain."))))}u.isMDXComponent=!0}}]);
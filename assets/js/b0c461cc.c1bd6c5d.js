"use strict";(self.webpackChunkrouter_docs=self.webpackChunkrouter_docs||[]).push([[3874],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,f=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(f,o(o({ref:t},p),{},{components:n})):r.createElement(f,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},31955:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const i={title:"ASM Implementation",sidebar_position:1},o=void 0,s={unversionedId:"message-transfer-via-crosstalk/near-guides/asm-implementation/README",id:"message-transfer-via-crosstalk/near-guides/asm-implementation/README",title:"ASM Implementation",description:"To understand how Router ASM works, refer to this link.",source:"@site/docs/develop/message-transfer-via-crosstalk/near-guides/asm-implementation/README.md",sourceDirName:"message-transfer-via-crosstalk/near-guides/asm-implementation",slug:"/message-transfer-via-crosstalk/near-guides/asm-implementation/",permalink:"/develop/message-transfer-via-crosstalk/near-guides/asm-implementation/",draft:!1,editUrl:"https://github.com/router-protocol/docs/tree/main/docs/develop/message-transfer-via-crosstalk/near-guides/asm-implementation/README.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"ASM Implementation",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"set_dapp_metadata",permalink:"/develop/message-transfer-via-crosstalk/near-guides/iDapp-functions/set_dapp_metadata"},next:{title:"Integrate ASM into Your Application",permalink:"/develop/message-transfer-via-crosstalk/near-guides/asm-implementation/integrate-asm-into-your-application"}},l={},c=[],p={toc:c};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"To understand how Router ASM works, refer to this ",(0,a.kt)("a",{parentName:"p",href:"../../message-transfer-via-crosstalk/key-concepts/additional-security-modules#how-does-an-asm-work"},"link"),".")),(0,a.kt)("p",null,"The function signature named ",(0,a.kt)("inlineCode",{parentName:"p"},"verify_cross_chain_request")," serves to provide additional security for a specific cross-chain flow."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fn verify_cross_chain_request(\n    &self,\n    request_identifier: U128,\n    request_timestamp: U128,\n    src_chain_id: String,\n    request_sender: String,\n    packet: Vec<u8>,\n    handler: AccountId,\n) -> bool;\n")),(0,a.kt)("p",null,"When a request is received on the destination chain, the ",(0,a.kt)("inlineCode",{parentName:"p"},"verify_cross_chain_request")," function selector is called on the specified ASM address before executing the user's contract calls. The ASM implementation can return ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"/",(0,a.kt)("inlineCode",{parentName:"p"},"false")," for instantly validating/invalidating the request. However, if they require more time for request validation, they can revert the request from their ASM."),(0,a.kt)("p",null,"As mentioned earlier, if this function returns ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),", the execution of the user contract calls will continue. If the return value is ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),", the execution of the user's contract calls will be skipped. If the ASM implementation reverts the request, then the transaction will be reverted, and no state will be modified on the Gateway as well."),(0,a.kt)("p",null,"The ASM module can revert the request until it is able to validate/invalidate the request. This will ensure that the application-level validation is completed before a cross-chain request is executed on the Gateway contract and sent to the user's destination contract."),(0,a.kt)("p",null,"Since this function can be called from the Gateway contract only, it must have the following security check."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'if env::predecessor_account_id() != self.gateway.clone() {\n  env::panic_str("Caller is not Gateway");\n}\n')),(0,a.kt)("p",null,"In this function selector, there are 6 arguments. Within this function, any possible business logic or validation can be added using these arguments. Each argument has its own purpose in the\xa0",(0,a.kt)("inlineCode",{parentName:"p"},"verify_cross_chain_request"),"\xa0request:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"1) ",(0,a.kt)("inlineCode",{parentName:"strong"},"request_identifier")," -")," A unique identifier of the request. It is added by the source chain's Gateway contract."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"2) ",(0,a.kt)("inlineCode",{parentName:"strong"},"request_timestamp")," -")," Timestamp when a request is added/verified on the Router chain."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"3) ",(0,a.kt)("inlineCode",{parentName:"strong"},"request_sender")," -")," Address of the application's contract on the source chain in string format."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"4) ",(0,a.kt)("inlineCode",{parentName:"strong"},"src_chain_id")," -")," Network ID of the chain from which the request to the Router chain was initiated."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"5) ",(0,a.kt)("inlineCode",{parentName:"strong"},"packet")," -")," This is the payload, i.e., the data to be transferred to the destination chain."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"6) ",(0,a.kt)("inlineCode",{parentName:"strong"},"handler")," -")," Address of the application's smart contract on the destination chain in address format."))}u.isMDXComponent=!0}}]);